{
  "hash": "5cca419eb882bc873bfeae8259662c9b",
  "result": {
    "markdown": "---\ntitle: \"Tidy Tuesday - 12/20\"\nauthor: \"Sam Weiner\"\ndate: \"1/9/2023\"\nimage: national_weather_service.png\ncategories: [tidytuesday, analysis]\nfreeze: auto\n---\n\nHello everyone! Tidy Tuesday released this data set on December 20th, 2022 and it is so interesting. It was collected as a part of a data science capstone project where national weather data was acquired to learn which areas of the U.S. struggle with weather prediction and the possible reasons why. Specifically, the project focused on the error in high and low temperature forecasting.\n\nThe data includes 16 months of daily forecasts and observations from 167 cities, as well as a separate data frame of information about those cities and some other American cities.\n\nSo let's dive into this data and learn something about forecasting weather! \n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(tidyverse)\nlibrary(skimr)\n#Tidyverts universe of packages\nlibrary(tsibble)\nlibrary(fable)\nlibrary(feasts)\nlibrary(lubridate)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nweather_forecasts <- read_csv(\"https://raw.githubusercontent.com/rfordatascience/tidytuesday/master/data/2022/2022-12-20/weather_forecasts.csv\")\ncities <- read_csv(\"https://raw.githubusercontent.com/rfordatascience/tidytuesday/master/data/2022/2022-12-20/cities.csv\")\noutlook_meanings <- read_csv(\"https://raw.githubusercontent.com/rfordatascience/tidytuesday/master/data/2022/2022-12-20/outlook_meanings.csv\")\n```\n:::\n\n\nThe weather forecasts data set contains daily high and daily low temperature forecasts 48, 36, 24, and 12 prior to every date in the data set. The data also contains the observed high and low temperature for that date. (Note: some dates have missing data for observed temperature.)\n\nHere's a glimpse at the column names, the number of rows, and the first couple of values in the weather forecasts data set.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nweather_forecasts |> glimpse()\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nRows: 651,968\nColumns: 10\n$ date                  <date> 2021-01-30, 2021-01-30, 2021-01-30, 2021-01-30,…\n$ city                  <chr> \"ABILENE\", \"ABILENE\", \"ABILENE\", \"ABILENE\", \"ABI…\n$ state                 <chr> \"TX\", \"TX\", \"TX\", \"TX\", \"TX\", \"TX\", \"TX\", \"TX\", …\n$ high_or_low           <chr> \"high\", \"high\", \"high\", \"high\", \"low\", \"low\", \"l…\n$ forecast_hours_before <dbl> 48, 36, 24, 12, 48, 36, 24, 12, 48, 36, 24, 12, …\n$ observed_temp         <dbl> 70, 70, 70, 70, 42, 42, 42, 42, 29, 29, 29, 29, …\n$ forecast_temp         <dbl> NA, NA, NA, 70, NA, NA, 39, 38, NA, NA, NA, 30, …\n$ observed_precip       <dbl> 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, …\n$ forecast_outlook      <chr> NA, NA, NA, \"DUST\", NA, NA, \"DUST\", \"SUNNY\", NA,…\n$ possible_error        <chr> \"none\", \"none\", \"none\", \"none\", \"none\", \"none\", …\n```\n:::\n:::\n\n\n\n\nThe data contains multiple time series, one for each combination of city, state, high_or_low, and forecast_hours_before. I think that looking into how the different forecast times compare in accuracy will be interesting to look at, as well as whether forecast accuracy differs at different times in the year.\n\nI will be using the tsibble package for this data which is useful when working with time series data. The first of which is that it enables us contain multiple time series in the same data structure, a time series tibble, and this allows us run models or check for certain features on multiple series simultaneously. If you want to learn more about time series analysis and how to use the tidyverts packages, I highly recommend reading [Forecasting: Principles and Practice (3rd ed)](https://otexts.com/fpp3/) by Rob J Hyndman and George Athanasopoulos. It is a very detailed book and covers a lot of ground in the field of time series.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nforecast_tsbl <- weather_forecasts |>\n  mutate(city = factor(city),\n         state = factor(state),\n         high_or_low = factor(high_or_low),\n         forecast_hours_before = factor(forecast_hours_before)) |> \n  as_tsibble(key = c(city, state, high_or_low, forecast_hours_before), index = date)\n```\n:::\n\n\nI am going to be subsetting the data to look at one city, Newark, NJ. This visualization is a time plot of the observed daily high temperature for Newark, NJ from January 30th, 2021 to June 1st, 2022.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nforecast_tsbl |> \n  filter(city == \"NEWARK\", high_or_low == \"high\", forecast_hours_before == 12) |>\n  autoplot(observed_temp)\n```\n\n::: {.cell-output .cell-output-stderr}\n```\nWarning: Removed 2 rows containing missing values (`geom_line()`).\n```\n:::\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-6-1.png){width=672}\n:::\n:::\n\n\n### Sliding Window\n\nWe will be looking at the rolling mean absolute error between forecasted high and low temperatures versus observed high and low temperatures across the different temperature forecasts.\n\nI am using a 30 day window around each date to compute the mean. I am also ignoring dates with missing values.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nslide_tsbl <- forecast_tsbl |> \n  filter(city == \"NEWARK\") |> \n  mutate(error = forecast_temp - observed_temp) |> \n  mutate(mean_temp_error = slider::slide_dbl(error,\n                                              ~mean(abs(.), na.rm = TRUE), \n                                              .before = 15,\n                                              .after = 15, \n                                              .complete = TRUE))\n```\n:::\n\n\nThis plot shows the mean absolute error across the dates for the *high* temperature forecast across forecast times.\n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"true\"}\nslide_tsbl |> \n  filter(high_or_low == \"high\") |> \n  ggplot() +\n  geom_line(aes(x = date, y = mean_temp_error)) + \n  facet_grid(vars(high_or_low, forecast_hours_before)) +\n  xlab(\"Date\") +\n  ylab(\"Mean Error\")\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-8-1.png){width=672}\n:::\n:::\n\n\nThis plot shows the average error across the dates for the *low* temperature forecast across forecast times.\n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"true\"}\nslide_tsbl |> \n  filter(high_or_low == \"low\") |> \n  ggplot() +\n  geom_line(aes(x = date, y = mean_temp_error)) + \n  facet_grid(vars(high_or_low, forecast_hours_before))  +\n  xlab(\"Date\") +\n  ylab(\"Mean Error\")\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-9-1.png){width=672}\n:::\n:::\n\n\nWe can see the overall mean absolute error for each forecast. \n\n\n::: {.cell}\n\n```{.r .cell-code}\nforecast_tsbl |> \n  as_tibble() |> \n  filter(city == \"NEWARK\", state == \"NJ\") |>  \n  mutate(error = forecast_temp - observed_temp) |>\n  group_by(forecast_hours_before) |> \n  summarise(MAE = mean(abs(error), na.rm = T))\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 4 × 2\n  forecast_hours_before   MAE\n  <fct>                 <dbl>\n1 12                     1.98\n2 24                     2.12\n3 36                     2.29\n4 48                     2.41\n```\n:::\n:::\n",
    "supporting": [
      "index_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}