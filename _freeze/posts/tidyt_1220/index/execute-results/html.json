{
  "hash": "2b6bf5e045b8a6d5cff8747eb48bbf11",
  "result": {
    "markdown": "---\ntitle: \"Tidy Tuesday - 12/20\"\nauthor: \"Sam Weiner\"\ndate: \"1/9/2023\"\ncategories: [tidytuesday, analysis]\nfreeze: auto\n---\n\n\nThe data includes 16 months of forecasts and observations from 167 cities, as well as a separate data.frame of information about those cities and some other American cities.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(tidyverse)\nlibrary(skimr)\nlibrary(tsibble)\nlibrary(fable)\nlibrary(feasts)\nlibrary(lubridate)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nweather_forecasts <- read_csv(\"https://raw.githubusercontent.com/rfordatascience/tidytuesday/master/data/2022/2022-12-20/weather_forecasts.csv\")\ncities <- read_csv(\"https://raw.githubusercontent.com/rfordatascience/tidytuesday/master/data/2022/2022-12-20/cities.csv\")\noutlook_meanings <- read_csv(\"https://raw.githubusercontent.com/rfordatascience/tidytuesday/master/data/2022/2022-12-20/outlook_meanings.csv\")\n```\n:::\n\n\nThis data set contains daily high and daily low temperature forecasts 48, 36, 24, and 12 prior to every date. The data also contains the observed high and low temperature for that date. (Note: some dates have missing data for observed temperature.)\n\n\n::: {.cell}\n\n```{.r .cell-code}\nweather_forecasts |> glimpse()\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nRows: 651,968\nColumns: 10\n$ date                  <date> 2021-01-30, 2021-01-30, 2021-01-30, 2021-01-30,…\n$ city                  <chr> \"ABILENE\", \"ABILENE\", \"ABILENE\", \"ABILENE\", \"ABI…\n$ state                 <chr> \"TX\", \"TX\", \"TX\", \"TX\", \"TX\", \"TX\", \"TX\", \"TX\", …\n$ high_or_low           <chr> \"high\", \"high\", \"high\", \"high\", \"low\", \"low\", \"l…\n$ forecast_hours_before <dbl> 48, 36, 24, 12, 48, 36, 24, 12, 48, 36, 24, 12, …\n$ observed_temp         <dbl> 70, 70, 70, 70, 42, 42, 42, 42, 29, 29, 29, 29, …\n$ forecast_temp         <dbl> NA, NA, NA, 70, NA, NA, 39, 38, NA, NA, NA, 30, …\n$ observed_precip       <dbl> 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, …\n$ forecast_outlook      <chr> NA, NA, NA, \"DUST\", NA, NA, \"DUST\", \"SUNNY\", NA,…\n$ possible_error        <chr> \"none\", \"none\", \"none\", \"none\", \"none\", \"none\", …\n```\n:::\n:::\n\n\n\n\nI will be using the the tsibble package which is has very nice properties when working with time series data. The first of which is that it enable us contain multiple timeseries in the same data structure, and this allows is run models or check for certain features on all of them simultaneously.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nforecast_tsbl <- weather_forecasts |>\n  mutate(city = factor(city),\n         state = factor(state),\n         high_or_low = factor(high_or_low),\n         forecast_hours_before = factor(forecast_hours_before)) |> \n  as_tsibble(key = c(city, state, high_or_low, forecast_hours_before), index = date)\n```\n:::\n\n\nI am going to be subsetting the data to look at one city, Newark, NJ. This visualization is a time plot of the observed high temperature for Newark, NJ from January 30th, 2021 to June 1st, 2022.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nforecast_tsbl |> \n  filter(city == \"NEWARK\", high_or_low == \"high\", forecast_hours_before == 12) |>\n  autoplot(observed_temp)\n```\n\n::: {.cell-output .cell-output-stderr}\n```\nWarning: Removed 2 rows containing missing values (`geom_line()`).\n```\n:::\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-6-1.png){width=672}\n:::\n:::\n\n\n### Sliding Window\n\nWe will be looking at the rolling mean absolute error between forecasted high and low temperatures versus observed high and low temperatures across the different temperature forecasts.\n\nI am using a 30 day window around each date to compute the mean I am also ignoring dates with missing values.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nslide_tsbl <- forecast_tsbl |> \n  filter(city == \"NEWARK\") |> \n  mutate(error = forecast_temp - observed_temp) |> \n  mutate(mean_temp_error = slider::slide_dbl(error,\n                                              ~abs(mean(., na.rm = TRUE)), \n                                              .before = 15,\n                                              .after = 15, \n                                              .complete = TRUE))\n```\n:::\n\n\nThis plot shows the mean absolute error across the dates for the *high* temperature forecast across forecast times.\n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"true\"}\nslide_tsbl |> \n  filter(high_or_low == \"high\") |> \n  ggplot() +\n  geom_line(aes(x = date, y = mean_temp_error)) + \n  facet_grid(vars(high_or_low, forecast_hours_before)) +\n  xlab(\"Date\") +\n  ylab(\"Mean Error\")\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-8-1.png){width=672}\n:::\n:::\n\n\nThis plot shows the average error across the dates for the *low* temperature forecast across forecast times.\n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"true\"}\nslide_tsbl |> \n  filter(high_or_low == \"low\") |> \n  ggplot() +\n  geom_line(aes(x = date, y = mean_temp_error)) + \n  facet_grid(vars(high_or_low, forecast_hours_before))  +\n  xlab(\"Date\") +\n  ylab(\"Mean Error\")\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-9-1.png){width=672}\n:::\n:::\n",
    "supporting": [
      "index_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}